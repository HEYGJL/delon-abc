{"version":3,"file":"loading.umd.js","sources":["../../../../packages/abc/loading/loading.component.ts","../../../../packages/abc/loading/loading.service.ts","../../../../packages/abc/loading/loading.module.ts","../../../../packages/abc/loading/loading.ts"],"sourcesContent":["import { Direction } from '@angular/cdk/bidi';\nimport { ChangeDetectionStrategy, Component, ViewEncapsulation } from '@angular/core';\nimport { LoadingCustom, LoadingIcon, LoadingShowOptions } from './loading.types';\n\n@Component({\n  selector: 'loading-default',\n  templateUrl: './loading.component.html',\n  host: {\n    '[class.loading-default]': 'true',\n    '[class.loading-default-rtl]': `dir === 'rtl'`,\n  },\n  preserveWhitespaces: false,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n})\nexport class LoadingDefaultComponent {\n  options: LoadingShowOptions;\n  dir: Direction = 'ltr';\n\n  get icon(): LoadingIcon {\n    return this.options.icon!;\n  }\n\n  get custom(): LoadingCustom {\n    return this.options.custom!;\n  }\n}\n","import { Directionality } from '@angular/cdk/bidi';\nimport { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { ComponentPortal } from '@angular/cdk/portal';\nimport { ComponentRef, Injectable, OnDestroy, Optional } from '@angular/core';\nimport { AlainConfigService, AlainLoadingConfig } from '@delon/util/config';\nimport { Subject, Subscription, timer } from 'rxjs';\nimport { debounce } from 'rxjs/operators';\nimport { LoadingDefaultComponent } from './loading.component';\nimport { LoadingShowOptions } from './loading.types';\n\n@Injectable({ providedIn: 'root' })\nexport class LoadingService implements OnDestroy {\n  private _overlayRef: OverlayRef;\n  private compRef: ComponentRef<LoadingDefaultComponent> | null = null;\n  private opt: LoadingShowOptions | null = null;\n  private cog: AlainLoadingConfig;\n  private n$ = new Subject();\n  private loading$: Subscription;\n\n  get instance(): LoadingDefaultComponent | null {\n    return this.compRef != null ? this.compRef.instance : null;\n  }\n\n  constructor(private overlay: Overlay, private configSrv: AlainConfigService, @Optional() private directionality: Directionality) {\n    this.cog = configSrv.merge('loading', {\n      type: 'spin',\n      text: '加载中...',\n      icon: {\n        type: 'loading',\n        theme: 'outline',\n        spin: true,\n      },\n      delay: 0,\n    })!;\n    this.loading$ = this.n$\n      .asObservable()\n      .pipe(debounce(() => timer(this.opt!.delay)))\n      .subscribe(() => this.create());\n  }\n\n  private create(): void {\n    if (this.opt == null) return;\n\n    this._close(false);\n\n    this._overlayRef = this.overlay.create({\n      positionStrategy: this.overlay.position().global().centerHorizontally().centerVertically(),\n      scrollStrategy: this.overlay.scrollStrategies.block(),\n      hasBackdrop: true,\n      backdropClass: 'loading-backdrop',\n    });\n    this.compRef = this._overlayRef.attach(new ComponentPortal(LoadingDefaultComponent));\n    const dir = this.configSrv.get('loading')!.direction || this.directionality.value;\n    Object.assign(this.instance, { options: this.opt, dir });\n    this.compRef.changeDetectorRef.markForCheck();\n  }\n\n  /**\n   * Open a new loading indicator\n   *\n   * 打开一个新加载指示符\n   */\n  open(options?: LoadingShowOptions): void {\n    this.opt = { ...this.cog, ...options };\n    this.n$.next();\n  }\n\n  private _close(cleanOpt: boolean): void {\n    if (cleanOpt) this.opt = null;\n    if (!this._overlayRef) return;\n    this._overlayRef.detach();\n    this.compRef = null;\n  }\n\n  /**\n   * Turn off a loading indicator\n   *\n   * 关闭一个加载指示符\n   */\n  close(): void {\n    this._close(true);\n  }\n\n  ngOnDestroy(): void {\n    this.loading$.unsubscribe();\n  }\n}\n","import { OverlayModule } from '@angular/cdk/overlay';\nimport { PortalModule } from '@angular/cdk/portal';\nimport { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { NzIconModule } from 'ng-zorro-antd/icon';\nimport { NzSpinModule } from 'ng-zorro-antd/spin';\nimport { LoadingDefaultComponent } from './loading.component';\n\nconst COMPONENTS = [LoadingDefaultComponent];\n\n@NgModule({\n  imports: [CommonModule, OverlayModule, PortalModule, NzIconModule, NzSpinModule],\n  declarations: COMPONENTS,\n  entryComponents: COMPONENTS,\n  exports: COMPONENTS,\n})\nexport class LoadingModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["Component","ChangeDetectionStrategy","ViewEncapsulation","Subject","debounce","timer","ComponentPortal","Injectable","Overlay","AlainConfigService","Directionality","Optional","NgModule","CommonModule","OverlayModule","PortalModule","NzIconModule","NzSpinModule"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAeA,QAAA,uBAAA,kBAAA,YAAA;IAXA,IAAA,SAAA,uBAAA,GAAA;IAaE,QAAA,IAAG,CAAA,GAAA,GAAc,KAAK,CAAC;SASxB;IAPC,IAAA,MAAA,CAAA,cAAA,CAAI,uBAAI,CAAA,SAAA,EAAA,MAAA,EAAA;IAAR,QAAA,GAAA,EAAA,YAAA;IACE,YAAA,OAAO,IAAI,CAAC,OAAO,CAAC,IAAK,CAAC;aAC3B;;;IAAA,KAAA,CAAA,CAAA;IAED,IAAA,MAAA,CAAA,cAAA,CAAI,uBAAM,CAAA,SAAA,EAAA,QAAA,EAAA;IAAV,QAAA,GAAA,EAAA,YAAA;IACE,YAAA,OAAO,IAAI,CAAC,OAAO,CAAC,MAAO,CAAC;aAC7B;;;IAAA,KAAA,CAAA,CAAA;;;;IArBF,IAAA,EAAA,IAAA,EAAAA,YAAS,EAAC,IAAA,EAAA,CAAA;IACT,gBAAA,QAAQ,EAAE,iBAAiB;IAC3B,gBAAA,QAAuC,EAAA,qhBAAA;IACvC,gBAAA,IAAI,EAAE;IACJ,oBAAA,yBAAyB,EAAE,MAAM;IACjC,oBAAA,6BAA6B,EAAE,eAAe;IAC/C,iBAAA;IACD,gBAAA,mBAAmB,EAAE,KAAK;oBAC1B,eAAe,EAAEC,0BAAuB,CAAC,MAAM;oBAC/C,aAAa,EAAEC,oBAAiB,CAAC,IAAI;IACtC,aAAA,EAAA,EAAA;;;ACHD,QAAA,cAAA,kBAAA,YAAA;IAYE,IAAA,SAAA,cAAA,CAAoB,OAAgB,EAAU,SAA6B,EAAsB,cAA8B,EAAA;YAA/H,IAeC,KAAA,GAAA,IAAA,CAAA;IAfmB,QAAA,IAAO,CAAA,OAAA,GAAP,OAAO,CAAS;IAAU,QAAA,IAAS,CAAA,SAAA,GAAT,SAAS,CAAoB;IAAsB,QAAA,IAAc,CAAA,cAAA,GAAd,cAAc,CAAgB;IAVvH,QAAA,IAAO,CAAA,OAAA,GAAiD,IAAI,CAAC;IAC7D,QAAA,IAAG,CAAA,GAAA,GAA8B,IAAI,CAAC;IAEtC,QAAA,IAAA,CAAA,EAAE,GAAG,IAAIC,YAAO,EAAE,CAAC;YAQzB,IAAI,CAAC,GAAG,GAAG,SAAS,CAAC,KAAK,CAAC,SAAS,EAAE;IACpC,YAAA,IAAI,EAAE,MAAM;IACZ,YAAA,IAAI,EAAE,QAAQ;IACd,YAAA,IAAI,EAAE;IACJ,gBAAA,IAAI,EAAE,SAAS;IACf,gBAAA,KAAK,EAAE,SAAS;IAChB,gBAAA,IAAI,EAAE,IAAI;IACX,aAAA;IACD,YAAA,KAAK,EAAE,CAAC;IACT,SAAA,CAAE,CAAC;IACJ,QAAA,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,EAAE;IACpB,aAAA,YAAY,EAAE;IACd,aAAA,IAAI,CAACC,kBAAQ,CAAC,YAAM,EAAA,OAAAC,UAAK,CAAC,KAAI,CAAC,GAAI,CAAC,KAAK,CAAC,CAAtB,EAAsB,CAAC,CAAC;iBAC5C,SAAS,CAAC,YAAM,EAAA,OAAA,KAAI,CAAC,MAAM,EAAE,CAAA,EAAA,CAAC,CAAC;SACnC;IAnBD,IAAA,MAAA,CAAA,cAAA,CAAI,cAAQ,CAAA,SAAA,EAAA,UAAA,EAAA;IAAZ,QAAA,GAAA,EAAA,YAAA;IACE,YAAA,OAAO,IAAI,CAAC,OAAO,IAAI,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;aAC5D;;;IAAA,KAAA,CAAA,CAAA;IAmBO,IAAA,cAAA,CAAA,SAAA,CAAA,MAAM,GAAN,YAAA;IACN,QAAA,IAAI,IAAI,CAAC,GAAG,IAAI,IAAI;gBAAE,OAAO;IAE7B,QAAA,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YAEnB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;IACrC,YAAA,gBAAgB,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,MAAM,EAAE,CAAC,kBAAkB,EAAE,CAAC,gBAAgB,EAAE;gBAC1F,cAAc,EAAE,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,KAAK,EAAE;IACrD,YAAA,WAAW,EAAE,IAAI;IACjB,YAAA,aAAa,EAAE,kBAAkB;IAClC,SAAA,CAAC,CAAC;IACH,QAAA,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAIC,sBAAe,CAAC,uBAAuB,CAAC,CAAC,CAAC;IACrF,QAAA,IAAM,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,SAAS,CAAE,CAAC,SAAS,IAAI,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC;IAClF,QAAA,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,OAAO,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,EAAA,GAAA,EAAE,CAAC,CAAC;IACzD,QAAA,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,YAAY,EAAE,CAAC;SAC/C,CAAA;IAED;;;;IAIG;QACH,cAAI,CAAA,SAAA,CAAA,IAAA,GAAJ,UAAK,OAA4B,EAAA;YAC/B,IAAI,CAAC,GAAG,GAAQ,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,EAAA,EAAA,IAAI,CAAC,GAAG,CAAA,EAAK,OAAO,CAAE,CAAC;IACvC,QAAA,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC;SAChB,CAAA;QAEO,cAAM,CAAA,SAAA,CAAA,MAAA,GAAN,UAAO,QAAiB,EAAA;IAC9B,QAAA,IAAI,QAAQ;IAAE,YAAA,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC;YAC9B,IAAI,CAAC,IAAI,CAAC,WAAW;gBAAE,OAAO;IAC9B,QAAA,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC;IAC1B,QAAA,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;SACrB,CAAA;IAED;;;;IAIG;IACH,IAAA,cAAA,CAAA,SAAA,CAAA,KAAK,GAAL,YAAA;IACE,QAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;SACnB,CAAA;IAED,IAAA,cAAA,CAAA,SAAA,CAAA,WAAW,GAAX,YAAA;IACE,QAAA,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC;SAC7B,CAAA;;;;;IA3EF,IAAA,EAAA,IAAA,EAAAC,aAAU,EAAC,IAAA,EAAA,CAAA,EAAE,UAAU,EAAE,MAAM,EAAE,EAAA,EAAA;;;;gBATzBC,UAAO,EAAA;gBAGPC,qBAAkB,EAAA;IAJlB,IAAA,EAAA,IAAA,EAAAC,iBAAc,uBAuByDC,WAAQ,EAAA,CAAA,EAAA;;;ICfxF,IAAM,UAAU,GAAG,CAAC,uBAAuB,CAAC,CAAC;AAQ7C,QAAA,aAAA,kBAAA,YAAA;IAAA,IAAA,SAAA,aAAA,GAAA;;;;;IANC,IAAA,EAAA,IAAA,EAAAC,WAAQ,EAAC,IAAA,EAAA,CAAA;oBACR,OAAO,EAAE,CAACC,mBAAY,EAAEC,gBAAa,EAAEC,mBAAY,EAAEC,iBAAY,EAAEC,iBAAY,CAAC;IAChF,gBAAA,YAAY,EAAE,UAAU;IACxB,gBAAA,eAAe,EAAE,UAAU;IAC3B,gBAAA,OAAO,EAAE,UAAU;IACpB,aAAA,EAAA,EAAA;;;ICfD;;IAEG;;;;;;;;;;;;"}