{"version":3,"names":["LoadingDefaultComponent","this","dir","Object","defineProperty","prototype","get","options","icon","custom","type","Component","args","selector","template","host","preserveWhitespaces","changeDetection","ChangeDetectionStrategy","OnPush","encapsulation","ViewEncapsulation","None","LoadingService","overlay","configSrv","directionality","_this","compRef","opt","n$","Subject","cog","merge","text","theme","spin","delay","loading$","asObservable","pipe","debounce","timer","subscribe","create","instance","_close","_overlayRef","positionStrategy","position","global","centerHorizontally","centerVertically","scrollStrategy","scrollStrategies","block","hasBackdrop","backdropClass","attach","ComponentPortal","direction","value","assign","changeDetectorRef","markForCheck","open","next","cleanOpt","detach","close","ngOnDestroy","unsubscribe","Injectable","providedIn","Overlay","AlainConfigService","Directionality","decorators","Optional","COMPONENTS","LoadingModule","NgModule","imports","CommonModule","OverlayModule","PortalModule","NzIconModule","NzSpinModule","declarations","entryComponents","exports"],"sources":["../../../../packages/abc/loading/loading.component.ts","../../../../packages/abc/loading/loading.service.ts","../../../../packages/abc/loading/loading.module.ts"],"sourcesContent":["import { Direction } from '@angular/cdk/bidi';\nimport { ChangeDetectionStrategy, Component, ViewEncapsulation } from '@angular/core';\nimport { LoadingCustom, LoadingIcon, LoadingShowOptions } from './loading.types';\n\n@Component({\n  selector: 'loading-default',\n  templateUrl: './loading.component.html',\n  host: {\n    '[class.loading-default]': 'true',\n    '[class.loading-default-rtl]': `dir === 'rtl'`,\n  },\n  preserveWhitespaces: false,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n})\nexport class LoadingDefaultComponent {\n  options: LoadingShowOptions;\n  dir: Direction = 'ltr';\n\n  get icon(): LoadingIcon {\n    return this.options.icon!;\n  }\n\n  get custom(): LoadingCustom {\n    return this.options.custom!;\n  }\n}\n","import { Directionality } from '@angular/cdk/bidi';\nimport { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { ComponentPortal } from '@angular/cdk/portal';\nimport { ComponentRef, Injectable, OnDestroy, Optional } from '@angular/core';\nimport { AlainConfigService, AlainLoadingConfig } from '@delon/util/config';\nimport { Subject, Subscription, timer } from 'rxjs';\nimport { debounce } from 'rxjs/operators';\nimport { LoadingDefaultComponent } from './loading.component';\nimport { LoadingShowOptions } from './loading.types';\n\n@Injectable({ providedIn: 'root' })\nexport class LoadingService implements OnDestroy {\n  private _overlayRef: OverlayRef;\n  private compRef: ComponentRef<LoadingDefaultComponent> | null = null;\n  private opt: LoadingShowOptions | null = null;\n  private cog: AlainLoadingConfig;\n  private n$ = new Subject();\n  private loading$: Subscription;\n\n  get instance(): LoadingDefaultComponent | null {\n    return this.compRef != null ? this.compRef.instance : null;\n  }\n\n  constructor(private overlay: Overlay, private configSrv: AlainConfigService, @Optional() private directionality: Directionality) {\n    this.cog = configSrv.merge('loading', {\n      type: 'spin',\n      text: '加载中...',\n      icon: {\n        type: 'loading',\n        theme: 'outline',\n        spin: true,\n      },\n      delay: 0,\n    })!;\n    this.loading$ = this.n$\n      .asObservable()\n      .pipe(debounce(() => timer(this.opt!.delay)))\n      .subscribe(() => this.create());\n  }\n\n  private create(): void {\n    if (this.opt == null) return;\n\n    this._close(false);\n\n    this._overlayRef = this.overlay.create({\n      positionStrategy: this.overlay.position().global().centerHorizontally().centerVertically(),\n      scrollStrategy: this.overlay.scrollStrategies.block(),\n      hasBackdrop: true,\n      backdropClass: 'loading-backdrop',\n    });\n    this.compRef = this._overlayRef.attach(new ComponentPortal(LoadingDefaultComponent));\n    const dir = this.configSrv.get('loading')!.direction || this.directionality.value;\n    Object.assign(this.instance, { options: this.opt, dir });\n    this.compRef.changeDetectorRef.markForCheck();\n  }\n\n  /**\n   * Open a new loading indicator\n   *\n   * 打开一个新加载指示符\n   */\n  open(options?: LoadingShowOptions): void {\n    this.opt = { ...this.cog, ...options };\n    this.n$.next();\n  }\n\n  private _close(cleanOpt: boolean): void {\n    if (cleanOpt) this.opt = null;\n    if (!this._overlayRef) return;\n    this._overlayRef.detach();\n    this.compRef = null;\n  }\n\n  /**\n   * Turn off a loading indicator\n   *\n   * 关闭一个加载指示符\n   */\n  close(): void {\n    this._close(true);\n  }\n\n  ngOnDestroy(): void {\n    this.loading$.unsubscribe();\n  }\n}\n","import { OverlayModule } from '@angular/cdk/overlay';\nimport { PortalModule } from '@angular/cdk/portal';\nimport { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { NzIconModule } from 'ng-zorro-antd/icon';\nimport { NzSpinModule } from 'ng-zorro-antd/spin';\nimport { LoadingDefaultComponent } from './loading.component';\n\nconst COMPONENTS = [LoadingDefaultComponent];\n\n@NgModule({\n  imports: [CommonModule, OverlayModule, PortalModule, NzIconModule, NzSpinModule],\n  declarations: COMPONENTS,\n  entryComponents: COMPONENTS,\n  exports: COMPONENTS,\n})\nexport class LoadingModule {}\n"],"mappings":"mvCAeAA,EAAA,WAXA,SAAAA,IAaEC,KAAGC,IAAc,M,OAEjBC,OAAAC,eAAIJ,EAAIK,UAAA,QAARC,IAAA,WACE,OAAOL,KAAKM,QAAQC,M,gCAGtBL,OAAAC,eAAIJ,EAAMK,UAAA,UAAVC,IAAA,WACE,OAAOL,KAAKM,QAAQE,Q,kCATxB,G,cAXC,CAAAC,KAAAC,YAAUC,KAAA,EACTC,SAAU,kBACVC,SAAuC,kgBACvCC,KAAM,CACJ,0BAA2B,OAC3B,8BAA+B,iBAEjCC,qBAAqB,EACrBC,gBAAiBC,0BAAwBC,OACzCC,cAAeC,oBAAkBC,SCFnC,IAAAC,EAAA,WAYE,SAAAA,EAAoBC,EAA0BC,EAAmDC,GAAjG,IAeCC,EAAA1B,KAfmBA,KAAOuB,QAAPA,EAA0BvB,KAASwB,UAATA,EAAmDxB,KAAcyB,eAAdA,EAVzFzB,KAAO2B,QAAiD,KACxD3B,KAAG4B,IAA8B,KAEjC5B,KAAA6B,GAAK,IAAIC,UAQf9B,KAAK+B,IAAMP,EAAUQ,MAAM,UAAW,CACpCvB,KAAM,OACNwB,KAAM,SACN1B,KAAM,CACJE,KAAM,UACNyB,MAAO,UACPC,MAAM,GAERC,MAAO,IAETpC,KAAKqC,SAAWrC,KAAK6B,GAClBS,eACAC,KAAKC,YAAS,WAAM,OAAAC,QAAMf,EAAKE,IAAKQ,WACpCM,WAAU,WAAM,OAAAhB,EAAKiB,Y,OAlB1BzC,OAAAC,eAAImB,EAAQlB,UAAA,YAAZC,IAAA,WACE,OAAuB,MAAhBL,KAAK2B,QAAkB3B,KAAK2B,QAAQiB,SAAW,M,gCAoBhDtB,EAAAlB,UAAAuC,OAAA,WACN,GAAgB,MAAZ3C,KAAK4B,IAAT,CAEA5B,KAAK6C,QAAO,GAEZ7C,KAAK8C,YAAc9C,KAAKuB,QAAQoB,OAAO,CACrCI,iBAAkB/C,KAAKuB,QAAQyB,WAAWC,SAASC,qBAAqBC,mBACxEC,eAAgBpD,KAAKuB,QAAQ8B,iBAAiBC,QAC9CC,aAAa,EACbC,cAAe,qBAEjBxD,KAAK2B,QAAU3B,KAAK8C,YAAYW,OAAO,IAAIC,kBAAgB3D,IAC3D,IAAME,EAAMD,KAAKwB,UAAUnB,IAAI,WAAYsD,WAAa3D,KAAKyB,eAAemC,MAC5E1D,OAAO2D,OAAO7D,KAAK4C,SAAU,CAAEtC,QAASN,KAAK4B,IAAK3B,IAAGA,IACrDD,KAAK2B,QAAQmC,kBAAkBC,iBAQjCzC,EAAIlB,UAAA4D,KAAJ,SAAK1D,GACHN,KAAK4B,IAAW1B,OAAA2D,OAAA3D,OAAA2D,OAAA,GAAA7D,KAAK+B,KAAQzB,GAC7BN,KAAK6B,GAAGoC,QAGF3C,EAAMlB,UAAAyC,OAAN,SAAOqB,GACTA,IAAUlE,KAAK4B,IAAM,MACpB5B,KAAK8C,cACV9C,KAAK8C,YAAYqB,SACjBnE,KAAK2B,QAAU,OAQjBL,EAAAlB,UAAAgE,MAAA,WACEpE,KAAK6C,QAAO,IAGdvB,EAAAlB,UAAAiE,YAAA,WACErE,KAAKqC,SAASiC,e,EAzElB,G,gMADC,CAAA7D,KAAA8D,aAAW5D,KAAA,EAAE6D,WAAY,W,yCATjBC,W,MAGAC,sBAJA,CAAAjE,KAAAkE,iBAAcC,WAAA,EAAAnE,KAuByDoE,gBCfhF,IAAMC,EAAa,CAAC/E,GAQpBgF,EAAA,a,cANC,CAAAtE,KAAAuE,WAASrE,KAAA,EACRsE,QAAS,CAACC,eAAcC,gBAAeC,eAAcC,eAAcC,gBACnEC,aAAcT,EACdU,gBAAiBV,EACjBW,QAASX,M"}